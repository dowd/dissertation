---
output:
  pdf_document:
    number_sections: yes
    toc: yes
  html_document: default
  word_document:
    toc: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(scales)
library(plyr)
library(knitr)
library(ggplot2)

cbPalette = c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7","#999999")
```
# CHAPTER 4 - RESULTS
## 4.1 Introduction
The results of the methods described in the previous chapter are set out under the same themes that were used in the methods section namely completeness, thematic accuracy, temporal quality, positional accuracy and contributors. The results for each section are displayed and then discussed. The chapter finishes with a discussion about what together the results mean for OSM as a data source for visually impaired people, this is done under the title of ‘usability’.

## 4.2 Completeness

*OSM data compared with the Ordnance Survey dataset*

```{r}

os_results=read.csv("../data/results/os_osm.csv", header=TRUE, stringsAsFactors = FALSE)

results=ddply(os_results,~City+Type,summarise,'Total'=sum(!is.na(City)),'< 20m'=sum(Points.Distance<20),'% <20m'=round((sum(Points.Distance<20))/(sum(!is.na(City)))*100,digits=2),'No. < 50m'=sum(Points.Distance<20),'% < 50m'=round((sum(Points.Distance<50))/(sum(!is.na(City)))*100,digits=2))
kable(results,caption="Table x - showing os_osm")
```

- As per literature there are big differences between areas e.g. in Bristol and Manchester over 80% of the Bus - Stops are included in the OSM data whereas in Cardiff it is only about 14%.
- There seems to be consistency in the number of railway stations in the OSM data at about 40% this could be down to the analysis method though as they were converted to point nodes {this might also be the issue with bus stations, may have to revisit the analysis of these!}
- Ignoring the anomalies of the stations and bus stops in Cardiff every other city/feature combination has over 50% coverage in the OSM data.
- Overall the figure of 64% is reasonable considering the anomalies that need looking at above.

*OSM data compared with Ground Survey*

```{r}
gsv_results=read.csv("../data/results/gsv_osm.csv", header=TRUE, stringsAsFactors = FALSE)

results=ddply(gsv_results,~City+Type,summarise,
              'Total features'=sum(!is.na(City)),
              'No. < 20m'=sum(Points.Distance<20),
              '% in OSM < 20m'=percent((sum(Points.Distance<20,na.rm=TRUE))/(sum(!is.na(City),na.rm=TRUE))),
              'No. < 50m'=sum(Points.Distance<20),
              '% in OSM < 50m'=percent((sum(Points.Distance<50,na.rm=TRUE))/(sum(!is.na(City),na.rm=TRUE)))
              )

kable(results,caption="Table x - showing gsv_osm")
```

## 4.3 Thematic Accuracy

*Inspection of tags of relevant OSM data features*
ADD TABLE AFTER DOING ANALYSIS IN R!!!


- {I need to add the sidewalk element attributes and possibly remove the entrance element}
- No crossings had a ‘length’ tag added to them but this is not in the OSM wiki.
- The majorities of crossings had a type added to them, though we see the differences in areas again with Manchester being just over 50% whereas Cardiff and Bristol have 80% and nearly 90%.
- The wheelchair accessible element needs removing as this is more for general accessibility
- The incline tag for steps is less than 10% for all areas this may be because it is hard to measure.
- The number of steps is very low with only Cardiff having over 2% coverage. This is something that could easily be added.
- The steps surface tag for all areas has about 5% coverage.

*Ground survey comparison of OSM tags*

ADD TABLE AFTER DOING IT!!!

## 4.4 Temporal Quality

*Inspection of the history of OSM elements*

```{r}
results=read.csv("../data/results/version_all_results.csv", header=TRUE, stringsAsFactors = FALSE)
results_relevant=read.csv("../data/results/version_relevant_results.csv", header=TRUE, stringsAsFactors = FALSE)
row.names(results)=results$city
results$X=NULL
results$city=NULL

row.names(results_relevant)=results_relevant$city
results_relevant$X=NULL
results_relevant$city=NULL


kable(t(results),caption="Table x - showing Version all results")
kable(t(results_relevant),caption="Table x - showing Version relevant results")
```

- The mean version number is higher for the data relevant to a visually impaired person.
- There is also a higher percentage of elements with over 5 edits.
- These both point to potentially higher data quality
- The number of days since the last edit is more for the relevant in Bristol and Manchester but not for Cardiff again showing the differences in data over area.

## 4.5 Positional Accuracy ##

*Comparison of OSM data with Ordnance Survey data*
```{r}
os_results=read.csv("../data/results/os_osm.csv", header=TRUE, stringsAsFactors = FALSE)

results=ddply(os_results,~City+Type,summarise,'Mean Distance'=mean(Points.Distance),'Total in OS'=sum(!is.na(City)),'Mean distance under 20m'=mean(Points.Distance[Points.Distance<20]),'Standard Deviation distance under 20m'=sd(Points.Distance[Points.Distance<20]),'Mean distance under 50m'=mean(Points.Distance[Points.Distance<50]),'Standard Deviation under 50m'=sd(Points.Distance[Points.Distance<50]))

is.num = sapply(results, is.numeric)
results[is.num] = lapply(results[is.num], round, 2)

kable(results,caption="Table x - showing gsv_osm_distances")


ggplot(data=subset(results, !is.na(`Mean distance under 50m`)), aes(fill=City, y=`Mean distance under 50m`, x=Type)) + geom_bar(position="dodge", stat="identity")+coord_flip()+scale_fill_manual(values=cbPalette)

ggplot(data=subset(os_results, (Points.Distance<50)), aes(Points.Distance, colour=City, fill=City)) + geom_density(alpha=0.55,bw=1)

ggplot(subset(os_results, (Points.Distance<50)), aes(factor(Type), Points.Distance)) + geom_violin(aes(fill = Type),bw=1)+scale_fill_manual(values=cbPalette)+coord_flip()+theme(legend.position="bottom",legend.title = element_blank())+labs(y="Distance from OS feature",x="Type")
```

- The high average and minimum distances for railway stations could be down to the issues stated above so needs revisiting.
- Again we see differences between areas with bus stops in cardiff being 9m away but only 3.8 in Manchester.
- Any city/element type combination with over 30 element has a max distance of 19-20m as 20m was the max distance used in the analysis. Further research could be done to do a ground survey with a high accuracy gps unit to check this data.
- The overall mean distance of 5.4m is not bad considering the source of the data but is not good for a visually impaired person trying to find something. The recommendation is for something to be within about 0.7m accuracy to be in the length of a cane (reference!). But the accuracy of a handheld gps is not going to better than that. For route planning this level of accuracy would be ok.

## 4.6 Contributors

*Analysis of OSM contributors*
```{r}

results=read.csv("../data/results/user_results.csv", header=TRUE, stringsAsFactors = FALSE)
results_relevant=results[!(is.na(results$Relevant.Nodes)),]

user_results_all=ddply(results,~city,summarise,
           "No. of contributions"=sum(City.Nodes),
           "No. of contributors"=sum(!is.na(City.Nodes)),
           "Contributions by senior mappers"=sum(City.Nodes[which(total_nodes>=1000)]),
           "Senior %"=percent((sum(City.Nodes[which(total_nodes>=1000)]))/(sum(City.Nodes))),
           "Contribution by junior mappers"=sum(City.Nodes[which(total_nodes<1000 & total_nodes>=10)]),
           "Junior %"=percent((sum(City.Nodes[which(total_nodes<1000 & total_nodes>=10)]))/(sum(City.Nodes))),
           "Contributions by nonrecurring mappers"=sum(City.Nodes[which(total_nodes<10)]),
           "% nonrecurring"=percent((sum(City.Nodes[which(total_nodes<10)]))/(sum(City.Nodes))),
           "Contributions by local mappers (>=50%)"=sum(City.Nodes[which((City.Nodes/total_nodes)>=0.5)]),
           "% local"=percent((sum(City.Nodes[which((City.Nodes/total_nodes)>=0.5)]))/(sum(City.Nodes))),
           "Contributions by semi-local mappers (20-50%)"=sum(City.Nodes[which(((City.Nodes/total_nodes)<0.5) & (City.Nodes/total_nodes)>=0.2)]),
           "% semi-local"=percent((sum(City.Nodes[which((City.Nodes/total_nodes)<0.5 & (City.Nodes/total_nodes>=0.2))]))/(sum(City.Nodes))),
           "Contributions by non-local mappers (<20%)"=sum(City.Nodes[which((City.Nodes/total_nodes)<0.2)]),
           "% non-local"=percent((sum(City.Nodes[which((City.Nodes/total_nodes)<0.2)]))/(sum(City.Nodes))))

user_results_relevant=ddply(results_relevant,~city,summarise,
                    "No. of contributions"=sum(Relevant.Nodes),
                    "No. of contributors"=sum(!is.na(City.Nodes)),
                    "Contributions by senior mappers"=sum(Relevant.Nodes[which(total_nodes>=1000)]),
                    "Senior %"=percent((sum(Relevant.Nodes[which(total_nodes>=1000)]))/(sum(Relevant.Nodes))),
                    "Contribution by junior mappers"=sum(Relevant.Nodes[which(total_nodes<1000 & total_nodes>=10)]),
                    "Junior %"=percent((sum(Relevant.Nodes[which(total_nodes<1000 & total_nodes>=10)]))/(sum(Relevant.Nodes))),
                    "Contributions by nonrecurring mappers"=sum(Relevant.Nodes[which(total_nodes<10)]),
                    "% nonrecurring"=percent((sum(Relevant.Nodes[which(total_nodes<10)]))/(sum(Relevant.Nodes))),
                    "Contributions by local mappers (>=50%)"=sum(Relevant.Nodes[which((City.Nodes/total_nodes)>=0.5)]),
                    "% local"=percent((sum(Relevant.Nodes[which((City.Nodes/total_nodes)>=0.5)]))/(sum(Relevant.Nodes))),
                    "Contributions by semi-local mappers (20-50%)"=sum(Relevant.Nodes[which(((City.Nodes/total_nodes)<0.5) & (City.Nodes/total_nodes)>=0.2)]),
                    "% semi-local"=percent((sum(Relevant.Nodes[which((City.Nodes/total_nodes)<0.5 & (City.Nodes/total_nodes>=0.2))]))/(sum(Relevant.Nodes))),
                    "Contributions by non-local mappers (<20%)"=sum(Relevant.Nodes[which((City.Nodes/total_nodes)<0.2)]),
                    "% non-local"=percent((sum(Relevant.Nodes[which((City.Nodes/total_nodes)<0.2)]))/(sum(Relevant.Nodes))))

row.names(user_results_all)=user_results_all$city
user_results_all$city=NULL

row.names(user_results_relevant)=user_results_relevant$city
user_results_relevant$city=NULL

kable(t(user_results_all),caption="Table x - showing user stats all")

kable(t(user_results_relevant),caption="Table x - showing user stats relevant")

```

- Can't really compare local mapper data between cities as dependent on area but can compare relevant vs whole city.
- Contributors that contribute relevant data tend to be more in the ‘Senior mappers’ group. This could be because the elements looked at are not standard features a beginner might map. This could indicate greater data quality for this data.
- There is little difference between contributors who contribute relevant data and all contributors when it comes to ‘local mappers’. We do see the difference in areas again with Manchester having more local mappers, this could be down to the bigger area though. {I could calculate the area of each location to compensate}

*Survey of OSM contributors*




ADD TABLE AFTER DOING IT!!!

## 4.7 Usability

- {Summary of all the above themes, bringing the discussion together.}

## 4.8 Discussion of results

# CHAPTER 5 - CONCLUSIONS

## 5.1 Conclusions

## 5.2 Recommendations

# 6 APPENDICES

## 6.1 References

## 6.2 R Scripts used

{All the R scripts used will be added here}

## 6.3 Bash scripts used

{All the bash scripts used will be added here}